@page "/cross-rates"

<PageTitle>@_pageTitle</PageTitle>

<div class="page-container">
    <div class="header-section">
        <h2>@_headerTitle</h2>
        <p class="description">
            @_headerDescription
        </p>
    </div>

    <div class="content-section">
        <div class="form-container">
            <div class="form-card">
                <div class="form-group">
                    <label for="currency1Select">@_labelCurrency1</label>
                    <select id="currency1Select" @bind="_selectedCurrency1" @bind:after="OnCurrencyChangedAsync" class="form-control" disabled="@_isLoadingData">
                        @if (_currencies.Any())
                        {
                            @foreach (var currency in _currencies)
                            {
                                <option value="@currency">@currency</option>
                            }
                        }
                        else
                        {
                            <option value="">@_loadingData</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label for="currency2Select">@_labelCurrency2</label>
                    <select id="currency2Select" @bind="_selectedCurrency2" @bind:after="OnCurrencyChangedAsync" class="form-control" disabled="@_isLoadingData">
                        @if (_currencies.Any())
                        {
                            @foreach (var currency in _currencies)
                            {
                                <option value="@currency">@currency</option>
                            }
                        }
                        else
                        {
                            <option value="">@_loadingData</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label for="startDate">@_labelStartDate</label>
                    <input id="startDate" type="date" @bind="_startDate" @bind:after="OnDateChangedAsync" class="form-control" disabled="@_isLoadingData"/>
                </div>
                <div class="form-group">
                    <label for="endDate">@_labelEndDate</label>
                    <input id="endDate" type="date" @bind="_endDate" @bind:after="OnDateChangedAsync" class="form-control" disabled="@_isLoadingData"/>
                </div>
                <button class="form-control" @onclick="FetchCrossRatesAsync" disabled="@_isLoadingData">
                    @(_isLoadingData ? _loadingData : _buttonFetchRates)
                </button>
            </div>
        </div>
        <div class="chart-section">
            @if (_dataLoaded || _isLoadingData)
            {
                <div style="text-align:right; margin-bottom: 1rem;">
                    <button class="inverted-btn" @onclick="ToggleTable" style="margin-right: 10px;">
                        @(_showTable ? _buttonShowChart : _buttonShowTable)
                    </button>
                    @if (_showTable && _chartData.Any())
                    {
                        <button class="inverted-btn" @onclick="DownloadTablePdf">
                            @_buttonDownloadPdf
                        </button>
                    }
                </div>
            }

            @if (_isLoadingData)
            {
                <div style="text-align:center; padding: 20px; color: #273F4F;">
                    <p>@_loadingData</p>
                </div>
            }
            else if (!_dataLoaded)
            {
                 <div style="text-align:center; padding: 20px; color: #273F4F;">
                    <p>@_initialPrompt</p>
                </div>
            }
            else
            {
                @if (_showTable)
                {
                    <div class="table-responsive">
                        <table class="table table-striped" id="crossRatesTable">
                            <thead>
                                <tr>
                                    <th>@_tableHeaderDate</th>
                                    <th>@_tableHeaderRate</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (_chartData.Length > 0)
                                {
                                    @for (int i = 0; i < _dates.Length; i++)
                                    {
                                        <tr>
                                            <td>@_dates[i]</td>
                                            <td>@_chartData[i].ToString("N4")</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="2" style="text-align:center;">@_tableNoData</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    @if (_chartData.Length > 0)
                    {
                        <div class="chart-container">
                            <canvas id="currencyChart"></canvas> @* <-- Changed ID here *@
                            <div id="chartTooltip" class="chart-tooltip"></div> @* <-- Changed ID here *@
                        </div>
                    }
                    else
                    {
                        <div style="text-align:center; padding: 20px; color: #273F4F;">
                            <p>@_tableNoData</p>
                        </div>
                    }
                }
            }
        </div>
    </div>
</div>